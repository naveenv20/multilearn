Mod from master_1 from NB branchs